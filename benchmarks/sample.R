
# sample a mixture of gaussians via a rational approximation of the inverse cdf
# http://home.online.no/~pjacklam/notes/invnorm/

ca <- c(-3.969683028665376e+01,
   	 2.209460984245205e+02,
   	-2.759285104469687e+02,
   	 1.383577518672690e+02,
   	-3.066479806614716e+01,
   	 2.506628277459239e+00)

cb <- c(-5.447609879822406e+01,
   	 1.615858368580409e+02,
   	-1.556989798598866e+02,
   	 6.680131188771972e+01,
   	-1.328068155288572e+01)


cc <- c(-7.784894002430293e-03,
	-3.223964580411365e-01,
   	-2.400758277161838e+00,
  	-2.549732539343734e+00,
  	 4.374664141464968e+00,
   	 2.938163982698783e+00)

cd <- c( 7.784695709041462e-03,
	 3.224671290700398e-01,
   	 2.445134137142996e+00,
   	 3.754408661907416e+00)

inv.cdf <- function(p) {
	ifelse(p < 0.02425,
		{q <- sqrt(-2*log(p));
		 (((((cc[1]*q+cc[2])*q+cc[3])*q+cc[4])*q+cc[5])*q+cc[6]) /
		 ((((cd[1]*q+cd[2])*q+cd[3])*q+cd[4])*q+1)},
	ifelse(p <= (1-0.02425),
		{q <- (p-0.5);
		 r <- q*q;
		 (((((ca[1]*r+ca[2])*r+ca[3])*r+ca[4])*r+ca[5])*r+ca[6])*q /
		 (((((cb[1]*r+cb[2])*r+cb[3])*r+cb[4])*r+cb[5])*r+1)},
	# p > p.high
		{q <- sqrt(-2*log(1-p));
		 -(((((cc[1]*q+cc[2])*q+cc[3])*q+cc[4])*q+cc[5])*q+cc[6]) /
		  ((((cd[1]*q+cd[2])*q+cd[3])*q+cd[4])*q+1)}))
}

means <- c(0,2,10)
sd <- c(1,0.1,3)

a <- 1:3 / 4 #runif(1000000)
i <- floor(1:3) #runif(1000000)*3)+1
b <- inv.cdf(a)*sd[i] + means[i]

print(b)

plot(density(b))

